<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tipos - MeEnsina</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    /* Cards */
    .card {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
      min-height: 450px;
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      padding: 15px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
    }

    .card-body {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .card iframe {
      width: 100%;
      height: 200px;
      border: none;
      margin-top: auto;
      border-radius: 10px;
    }

    #resultado {
      margin-top: 100px;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <header>
    <nav class="navbar navbar-expand-lg fixed-top" 
         style="background-color: #ffffff; box-shadow: 0 4px 16px rgba(156, 58, 59, 0.15);">
      <div class="container-fluid position-relative">

        <!-- Logo -->
        <a class="navbar-brand" href="index.html" style="margin-left: 35px;">
          <img src="img/logo_meensina (2).png" alt="Logo do site" class="img-fluid logo" style="width: 3em;" />
        </a>

        <!-- Menu mobile -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarNav" aria-controls="navbarNav"
                aria-expanded="false" aria-label="Alternar navegação"
                style="border-color: #000;">
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Itens do menu -->
        <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
          <ul class="navbar-nav d-flex flex-lg-row flex-column align-items-center gap-4 text-center">
            <li class="nav-item"><a class="nav-link" href="index.html">Início</a></li>
            <li class="nav-item"><a class="nav-link" href="index.html">Tutorial</a></li>
            <li class="nav-item"><a class="nav-link" href="index.html">Contribuintes</a></li>
            <li class="nav-item"><a class="nav-link" href="contato.html">Contato</a></li>

            <!-- Mobile: Login/Cadastro -->
            <li class="nav-item d-lg-none mt-2">
              <a class="btn perfil w-100" href="login.html">Entrar</a>
            </li>
            <li class="nav-item d-lg-none mt-2 mb-2">
              <a class="btn sair w-100" href="cadastro.html">Cadastrar</a>
            </li>
          </ul>
        </div>

        <!-- Desktop Login/Cadastro -->
        <div class="d-none d-lg-flex align-items-center gap-2 position-absolute end-0 me-4">
          <a class="btn perfil" href="login.html">Entrar</a>
          <a class="btn sair" href="cadastro.html">Cadastrar</a>
        </div>
      </div>
    </nav>
  </header>

  <!-- Conteúdo principal -->
  <div class="container my-5">
    <div id="resultado" class="row justify-content-center text-left" style="margin-top: 100px;">
      <p class="text-secondary">Carregando tutoriais...</p>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-light text-center py-3 border-top">
    <p class="mb-0 text-secondary">© 2025 MeEnsina - Tutoriais domésticos</p>
  </footer>

  <!-- Script -->
  <script>
    const API_URL = "https://68ecdd76eff9ad3b14039a17.mockapi.io/tutoriais";

    // Converter link do YouTube
    function converterLinkYoutube(url) {
      if (!url) return "";
      if (url.includes("youtube.com/watch?v=")) {
        const id = url.split("v=")[1].split("&")[0];
        return `https://www.youtube.com/embed/${id}`;
      } else if (url.includes("youtu.be/")) {
        const id = url.split("youtu.be/")[1].split("?")[0];
        return `https://www.youtube.com/embed/${id}`;
      } else {
        return url;
      }
    }

    // Normalizar texto
    function normalizarTexto(texto) {
      return texto
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .toLowerCase()
        .trim();
    }

    // Carregar tutoriais
    async function carregarTutoriaisPorTipo() {
      const urlParams = new URLSearchParams(window.location.search);
      const tipoSelecionado = urlParams.get("tipo");
      const container = document.getElementById("resultado");
      container.innerHTML = `<p class="text-secondary">Carregando tutoriais...</p>`;

      try {
        const resposta = await fetch(API_URL);
        const tutoriais = await resposta.json();

        if (!Array.isArray(tutoriais) || tutoriais.length === 0) {
          container.innerHTML = `<p class="text-danger">Nenhum tutorial disponível</p>`;
          return;
        }

        let filtrados = tutoriais;
        if (tipoSelecionado) {
          filtrados = tutoriais.filter(t =>
            t.tipo && normalizarTexto(t.tipo) === normalizarTexto(tipoSelecionado)
          );
        }

        if (filtrados.length === 0) {
          container.innerHTML = `<p class="text-danger">Nenhum tutorial encontrado para este tipo</p>`;
          return;
        }

        const titulo = tipoSelecionado
          ? tipoSelecionado.charAt(0).toUpperCase() + tipoSelecionado.slice(1)
          : "Todos";

        container.innerHTML = `<h3 class="text-primary mb-4">Tutoriais de ${titulo}</h3>`;

        filtrados.forEach(t => {
          const div = document.createElement("div");
          div.classList.add("col-12", "col-md-6", "col-lg-4", "mb-4");

          const passosHTML = t.passos?.length
            ? `<ol>${t.passos.map(p => `<li>${p}</li>`).join("")}</ol>`
            : "<p class='text-muted'>Sem passos cadastrados.</p>";

          const videoHTML = t.video
            ? `<div class="ratio ratio-16x9 mt-3">
                 <iframe src="${converterLinkYoutube(t.video)}" frameborder="0" allowfullscreen></iframe>
               </div>`
            : "";

          div.innerHTML = `
            <div class="card h-100 shadow-sm">
              <div class="card-body">
                <h5 class="card-title text-primary">${t.titulo}</h5>
                <p><strong>Tipo:</strong> ${t.tipo || "Não informado"}</p>
                ${t.marca ? `<p><strong>Marca:</strong> ${t.marca}</p>` : ""}
                ${t.autor ? `<p><strong>Autor:</strong> ${t.autor}</p>` : ""}
                <p class="mt-3"><strong>Passos:</strong></p>
                ${passosHTML}
                ${videoHTML}
              </div>
            </div>
          `;
          container.appendChild(div);
        });
      } catch (erro) {
        console.error("Erro ao carregar:", erro);
        container.innerHTML = `<p class="text-danger">Erro ao conectar com o servidor</p>`;
      }
    }

    document.addEventListener("DOMContentLoaded", carregarTutoriaisPorTipo);
  </script>
</body>
</html>
