name: CI - Monitoramento dos Projetos

# Dispara quando há push ou pull request para a branch main
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    name: Verificação de estrutura e testes
    runs-on: ubuntu-latest  # Usa máquina Linux padrão do GitHub Actions

    steps:
      # 1. Clona o repositório no ambiente do GitHub Actions
      - name: Clonar o repositório
        uses: actions/checkout@v4

      # 2. Lista a estrutura de arquivos enviada pelo aluno
      - name: Exibir estrutura de arquivos
        run: |
          echo "Listando arquivos enviados pelos alunos:"
          tree || ls -R  # Usa tree se disponível, senão ls -R

      # 3. Verifica se existe o arquivo index.html (obrigatório)
      - name: Verificar se o projeto contém index.html
        run: |
          if [ ! -f "index.html" ]; then
            echo "::error::Arquivo index.html não encontrado!"
            exit 1  # Interrompe o pipeline se não encontrar
          else
            echo "index.html encontrado!"
          fi

      # 4. Instala Node.js (necessário para rodar HTMLHint via npm)
      - name: Instalar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'  # Versão estável do Node

      # 5. Instala HTMLHint globalmente
      - name: Instalar HTMLHint
        run: npm install -g htmlhint

      # 6. Valida todos os arquivos HTML do projeto
      - name: Validar HTML com HTMLHint
        run: |
          echo "Validando arquivos HTML..."
          htmlhint "**/*.html"  # Analisa todos os arquivos .html

      # 7. Exibe mensagem final de sucesso
      - name: Enviar resultado do build
        run: echo "✅ Pipeline executada com sucesso!"